<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Poll Field Type | mikadamczyk.github.io</title>
<meta name="generator" content="Jekyll v3.7.3" />
<meta property="og:title" content="Poll Field Type" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/presentations/extending-ez-platform-ui/slides/field-type-site.html" />
<meta property="og:url" content="http://localhost:4000/presentations/extending-ez-platform-ui/slides/field-type-site.html" />
<meta property="og:site_name" content="mikadamczyk.github.io" />
<script type="application/ld+json">
{"url":"http://localhost:4000/presentations/extending-ez-platform-ui/slides/field-type-site.html","headline":"Poll Field Type","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=77f374eff6625557aeb40b1a914c0570328a44c9">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">mikadamczyk.github.io</a></h1>
      

      <h2 id="poll-field-type">Poll Field Type</h2>
<h3 id="site">site</h3>

<h3 id="creating-a-pollvote-entity-class">Creating a <code class="highlighter-rouge">PollVote</code> Entity Class</h3>

<ul>
  <li>question</li>
  <li>answer</li>
  <li>fieldId</li>
  <li>contentId</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/console doctrine:schema:update <span class="nt">--dump-sq</span>
</code></pre></div></div>

<h3 id="final-class-pollvoterepository">Final class <code class="highlighter-rouge">PollVoteRepository</code></h3>

<h3 id="polltype-class"><code class="highlighter-rouge">PollType</code> class</h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="nf">buildForm</span><span class="p">(</span><span class="nx">FormBuilderInterface</span> <span class="nv">$builder</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$choices</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$options</span><span class="p">[</span><span class="s1">'answers'</span><span class="p">],</span> <span class="k">function</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$value</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="nf">configureOptions</span><span class="p">(</span><span class="nx">OptionsResolver</span> <span class="nv">$resolver</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">....</span>
    <span class="nv">$resolver</span><span class="o">-&gt;</span><span class="na">setRequired</span><span class="p">(</span><span class="s1">'answers'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="formfactory"><code class="highlighter-rouge">FormFactory</code></h3>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">public</span> <span class="k">function</span> <span class="nf">createPollForm</span><span class="p">(</span>
        <span class="nx">PollVote</span> <span class="nv">$data</span><span class="p">,</span>
        <span class="o">?</span><span class="nx">string</span> <span class="nv">$name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
        <span class="k">array</span> <span class="nv">$answers</span>
    <span class="p">)</span><span class="o">:</span> <span class="nx">FormInterface</span> <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$name</span> <span class="o">?:</span> <span class="nx">StringUtil</span><span class="o">::</span><span class="na">fqcnToBlockPrefix</span><span class="p">(</span><span class="nx">PollType</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="nv">$options</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">!==</span> <span class="nv">$answers</span> <span class="o">?</span> <span class="p">[</span><span class="s1">'answers'</span> <span class="o">=&gt;</span> <span class="nv">$answers</span><span class="p">]</span> <span class="o">:</span> <span class="p">[];</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formFactory</span><span class="o">-&gt;</span><span class="na">createNamed</span><span class="p">(</span>
            <span class="nv">$name</span><span class="p">,</span>
            <span class="nx">PollType</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
            <span class="nv">$data</span><span class="p">,</span>
            <span class="nv">$options</span>
        <span class="p">);</span>
    <span class="p">}</span>
</code></pre></div></div>

<h4 id="pollcontrollervoteaction"><code class="highlighter-rouge">PollController::voteAction()</code></h4>
<p>We need a new method to handle voting.</p>

<h3 id="parameterprovider"><code class="highlighter-rouge">ParameterProvider</code></h3>
<p>provides additional parameters to a Field Typeâ€™s view template.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ParameterProvider</span> <span class="k">implements</span> <span class="nx">ParameterProviderInterface</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getViewParameters</span><span class="p">(</span><span class="nx">Field</span> <span class="nv">$field</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$pollData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PollVote</span><span class="p">();</span>
        <span class="nv">$pollData</span><span class="o">-&gt;</span><span class="na">setQuestion</span><span class="p">(</span><span class="nv">$field</span><span class="o">-&gt;</span><span class="na">value</span><span class="o">-&gt;</span><span class="na">question</span><span class="p">);</span>
        <span class="nv">$pollForm</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">formFactory</span><span class="o">-&gt;</span><span class="na">createPollForm</span><span class="p">(</span><span class="nv">$pollData</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nv">$field</span><span class="o">-&gt;</span><span class="na">value</span><span class="o">-&gt;</span><span class="na">answers</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'pollForm'</span> <span class="o">=&gt;</span> <span class="nv">$pollForm</span><span class="o">-&gt;</span><span class="na">createView</span><span class="p">(),</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="parameterprovider-needs-to-be-registered-in-the-parameterproviderregistry"><code class="highlighter-rouge">ParameterProvider</code> needs to be registered in the <code class="highlighter-rouge">ParameterProviderRegistry</code></h4>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
    <span class="s">...</span>
    <span class="s">AppBundle\eZ\Publish\FieldType\Poll\ParameterProvider</span><span class="pi">:</span>
        <span class="na">tags</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="pi">{</span><span class="nv">name</span><span class="pi">:</span> <span class="nv">ezpublish.fieldType.parameterProvider</span><span class="pi">,</span> <span class="nv">alias</span><span class="pi">:</span> <span class="nv">ezpoll</span><span class="pi">}</span>
</code></pre></div></div>

<h4 id="create-field-type-template-for-the-site-siteaccess">Create Field Type template for the site SiteAccess</h4>

<div class="language-twig highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">{# Resources/views/ezpoll_view.html.twig #}</span>

<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">"EzPublishCoreBundle::content_fields.html.twig"</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">ezpoll_field</span> <span class="cp">%}</span>
    ...
    <span class="cp">{{</span> <span class="nv">form_start</span><span class="p">(</span><span class="nv">parameters.pollForm</span><span class="p">,</span> <span class="err">{</span><span class="s1">'action'</span><span class="err">:</span> <span class="nv">path</span><span class="p">(</span><span class="s1">'ez_systems_poll_vote'</span><span class="p">,</span> <span class="err">{</span>
        <span class="s1">'contentId'</span><span class="err">:</span> <span class="nv">content.id</span><span class="p">,</span>
        <span class="s1">'fieldDefIdentifier'</span><span class="err">:</span> <span class="nv">field.fieldDefIdentifier</span>
    <span class="err">}</span><span class="p">),</span> <span class="s1">'method'</span><span class="err">:</span> <span class="s1">'POST'</span><span class="err">}</span><span class="p">)</span> <span class="cp">}}</span>
    <span class="cp">{{</span> <span class="nv">form_widget</span><span class="p">(</span><span class="nv">parameters.pollForm</span><span class="p">)</span> <span class="cp">}}</span>
    ...
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>


</code></pre></div></div>

<h4 id="register-field-type-template-for-the-site-siteaccess">Register Field Type template for the site SiteAccess</h4>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">system</span><span class="pi">:</span>
    <span class="na">site</span><span class="pi">:</span>
        <span class="na">field_templates</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="pi">{</span><span class="nv">template</span><span class="pi">:</span> <span class="s1">'</span><span class="s">AppBundle::ezpoll_view.html.twig'</span><span class="pi">,</span> <span class="nv">priority</span><span class="pi">:</span> <span class="nv">0</span><span class="pi">}</span>
</code></pre></div></div>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
